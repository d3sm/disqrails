<% content_for :sidebar do %>
  <% if @tags.any? %>
    <section id="tags-sidebar" data-collapsed="false" class="sticky top-20 w-full rounded-card border border-line bg-surface p-3 shadow-card">
      <div class="mb-2 flex items-center justify-between gap-2">
        <h2 class="m-0 text-sm font-semibold text-primary">Tags</h2>
        <button
          type="button"
          data-sidebar-toggle
          class="rounded-btn border border-line px-2 py-1 text-xs text-muted hover:text-accent cursor-pointer"
        >
          <span data-sidebar-label-expanded>Collapse</span>
          <span data-sidebar-label-collapsed>Expand</span>
        </button>
      </div>
      <div data-sidebar-content class="flex flex-wrap items-start gap-1.5 text-sm">
        <% @tags.each do |tag| %>
          <% active = @current_tag&.id == tag.id %>
          <%= link_to tag.name, posts_path(source: @source_filter, tag: tag.slug, sort: @sort),
            class: "inline-flex w-auto self-start rounded-pill px-2 py-1 text-xs no-underline whitespace-nowrap #{active ? 'bg-accent text-white' : 'bg-surface-2 text-muted hover:text-accent'}" %>
        <% end %>
      </div>
    </section>
  <% end %>
<% end %>

<section class="mt-6 mb-4">
  <h1 class="m-0 text-2xl sm:text-3xl leading-tight"><%= link_to "disqrails", root_path, class: "text-primary no-underline hover:underline" %></h1>

  <details class="mt-4 mb-8 text-muted text-sm">
    <summary class="cursor-pointer hover:text-primary list-none">
      <span class="select-none">ğŸ‘‰ğŸ»</span> About this site
    </summary>

    <div class="mt-1 pl-4">
      <p class="my-1">A personal feed reader I built to run through headlines and try new stack. Feel free to fork or use this instance via GitHub Auth.</p>
      <p>
        Inspired by:
        <%= link_to "Lobsters", "https://lobste.rs", class: "text-accent no-underline hover:underline", target: "_blank" %>,
        <%= link_to "engineeringblogs.xyz", "https://engineeringblogs.xyz", class: "text-accent no-underline hover:underline", target: "_blank" %>,
        <%= link_to "Bear Blog", "https://bearblog.dev/discover/", class: "text-accent no-underline hover:underline", target: "_blank" %>,
        <%= link_to "Techmeme", "https://www.techmeme.com", class: "text-accent no-underline hover:underline", target: "_blank" %>,
        <%= link_to "LWN", "https://lwn.net", class: "text-accent no-underline hover:underline", target: "_blank" %>,
        <%= link_to "Lemmy", "https://lemmy.ml/c/technology", class: "text-accent no-underline hover:underline", target: "_blank" %>
      </p>
    </div>
  </details>

  <% general_source = (@sort == "hot_external" ? nil : @source_filter) %>
  <% general_tag = (@sort == "hot_external" ? nil : @tag_filter) %>
  <nav class="mb-4 flex gap-3 text-base">
    <%= link_to "All", posts_path, class: "no-underline #{@source_filter.blank? && @tag_filter.blank? ? 'text-primary font-bold' : 'text-muted hover:text-accent'}" %>
    <%= link_to "Blogs", posts_path(source: "feed"), class: "no-underline #{@source_filter == 'feed' ? 'text-primary font-bold' : 'text-muted hover:text-accent'}" %>
    <%= link_to "Discussions", posts_path(source: "external"), class: "no-underline #{@source_filter == 'external' ? 'text-primary font-bold' : 'text-muted hover:text-accent'}" %>
    <span class="ml-auto flex gap-2">
      <%= link_to "New", posts_path(source: general_source, tag: general_tag, sort: "new"),
        class: "no-underline text-sm #{@sort == 'new' ? 'text-primary font-bold' : 'text-muted hover:text-accent'}" %>
      <%= link_to "Hot", posts_path(source: general_source, tag: general_tag, sort: "hot"),
        class: "no-underline text-sm #{@sort == 'hot' ? 'text-primary font-bold' : 'text-muted hover:text-accent'}" %>
      <%= link_to "Hot (external)", posts_path(sort: "hot_external"),
        class: "no-underline text-sm #{@sort == 'hot_external' ? 'text-primary font-bold' : 'text-muted hover:text-accent'}" %>
    </span>
  </nav>

  <% if @tags.any? %>
    <div class="mt-1.5 flex flex-wrap gap-1 sm:hidden">
      <% @tags.each do |tag| %>
        <% active = @current_tag&.id == tag.id %>
        <%= link_to tag.name, posts_path(source: @source_filter, tag: tag.slug, sort: @sort),
          class: "rounded-pill px-2 py-px text-xs no-underline #{active ? 'bg-accent text-white' : 'bg-surface-2 text-muted hover:text-accent'}" %>
      <% end %>
    </div>
  <% end %>
</section>

<% if @current_tag.present? %>
  <div class="mb-2 flex items-center gap-2 text-sm">
    <span class="text-muted">Showing posts tagged:</span>
    <span class="rounded-pill px-2 py-px text-xs bg-accent text-white"><%= @current_tag.name %></span>
    <%= link_to "clear", posts_path(source: @source_filter, sort: @sort), class: "text-accent no-underline hover:underline text-xs" %>
  </div>
<% end %>

<section class="card p-2.5">
  <% if @posts.any? %>
    <ol class="list-numbered m-0 p-0 pl-10">
      <% @posts.each do |post| %>
        <%= render "posts/post_item", post: post %>
      <% end %>
      <%= render "posts/load_more" %>
    </ol>
  <% else %>
    <p class="my-4 text-muted text-center">
      Posts are being fetched &mdash; check back in a minute.
    </p>
  <% end %>
</section>
