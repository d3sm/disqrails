<section class="page-head">
  <h1 class="page-title"><%= link_to "Hacker on Rails", latest_posts_path, class: "post-title" %></h1>
  <p class="page-subtitle">Read-only mirror of Hacker News top stories.</p>
  <p class="page-subtitle"><%= link_to "Refresh stories", posts_path(refresh: 1), class: "top-link" %></p>
</section>

<section class="list-card">
  <% if @posts.any? %>
    <ol
      class="post-list"
      id="post-list"
      data-next-page="<%= @next_page %>"
      data-fetch-url="<%= posts_path(format: :json) %>"
    >
      <% @posts.each do |post| %>
        <li class="post-item">
          <%= link_to post.title, post_path(post), class: "post-title" %>
          <% if post.source == "hacker_news" %>
            <span class="source-badge">hn</span>
          <% end %>
          <% if post.url.present? %>
            <span class="post-domain"><%= post.url %></span>
          <% end %>
          <div class="post-meta">
            <span><%= pluralize(post.score, "point") %></span>
            <span>by <%= post.author_name %></span>
            <span><%= pluralize(post.comment_count, "comment") %></span>
            <% if post.source == "hacker_news" && post.hn_rank.present? %>
              <span>rank #<%= post.hn_rank %> on hn</span>
            <% end %>
            <span>posted <%= time_ago_in_words(post.created_at) %> ago</span>
          </div>
        </li>
      <% end %>
    </ol>
    <div class="posts-pagination">
      <button type="button" id="posts-load-more" class="posts-load-more">Load 20 more</button>
      <div id="posts-sentinel" class="posts-sentinel" aria-hidden="true"></div>
    </div>
  <% else %>
    <p class="empty-state">
      No posts yet. Refresh in a moment to let the Hacker News importer run.
    </p>
  <% end %>
</section>
